<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jaxrs="http://cxf.apache.org/jaxrs"
	xmlns:cxf="http://cxf.apache.org/core" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
         http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
         http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
         http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd">

    <!-- FILES -->

    <bean id="fileAPIService" class="edu.illinois.i3.htrc.registry.api.file.FilesAPIImpl" />

    <bean id="jaxbFileProvider" class="org.apache.cxf.jaxrs.provider.JAXBElementProvider">
        <property name="singleJaxbContext" value="true" />
        <property name="marshallerProperties" ref="propertiesMap" />
        <property name="produceMediaTypes" ref="xmlFileProduceTypes" />
    </bean>

    <bean id="jsonFileProvider" class="org.apache.cxf.jaxrs.provider.json.JSONProvider">
        <property name="singleJaxbContext" value="true" />
        <property name="produceMediaTypes" ref="jsonFileProduceTypes" />
        <property name="namespaceMap" ref="jsonFileNamespaceMap"/>
    </bean>

    <jaxrs:server id="files" address="/files">
        <jaxrs:serviceBeans>
            <ref bean="fileAPIService" />
        </jaxrs:serviceBeans>

        <jaxrs:providers>
            <ref bean="jaxbFileProvider" />
            <ref bean="jsonFileProvider" />
        </jaxrs:providers>
    </jaxrs:server>

    <util:list id="xmlFileProduceTypes">
       <value>application/xml</value>
       <value>application/vnd.htrc-entry+xml</value>
    </util:list>

    <util:list id="jsonFileProduceTypes">
       <value>application/json</value>
       <value>application/vnd.htrc-entry+json</value>
    </util:list>

    <util:map id="jsonFileNamespaceMap" map-class="java.util.Hashtable">
        <entry key="http://registry.htrc.i3.illinois.edu/entities/file" value="" />
    </util:map>


    <!-- WORKSETS -->

	<bean id="worksetAPIService" class="edu.illinois.i3.htrc.registry.api.workset.WorksetsAPIImpl" />

	<bean id="jaxbWorksetProvider" class="org.apache.cxf.jaxrs.provider.JAXBElementProvider">
		<property name="singleJaxbContext" value="true" />
        <property name="produceMediaTypes" ref="xmlWorksetProduceTypes" />
        <property name="consumeMediaTypes" ref="xmlWorksetConsumeTypes" />
		<property name="marshallerProperties" ref="propertiesMap" />
		<!-- <property name="namespacePrefixes" ref="xmlWorksetNamespaceMap" /> -->
		<property name="extraClass" ref="extraWorksetClassesList" />
	</bean>

    <bean id="jsonWorksetProvider" class="org.apache.cxf.jaxrs.provider.json.JSONProvider">
        <property name="singleJaxbContext" value="true" />
        <property name="produceMediaTypes" ref="jsonWorksetProduceTypes" />
        <property name="consumeMediaTypes" ref="jsonWorksetConsumeTypes" />
        <property name="namespaceMap" ref="jsonWorksetNamespaceMap"/>
        <property name="extraClass" ref="extraWorksetClassesList" />
        <!-- <property name="serializeAsArray" value="true" /> -->
        <!-- <property name="arrayKeys" ref="jsonWorksetKeys" /> -->
        <!-- <property name="dropRootElement" value="true" /> -->
        <!-- <property name="supportUnwrapped" value="true" /> -->
    </bean>

	<jaxrs:server id="worksets" address="/worksets">
		<jaxrs:features>
			<!-- <cxf:logging/> -->
		</jaxrs:features>

		<jaxrs:serviceBeans>
			<ref bean="worksetAPIService" />
		</jaxrs:serviceBeans>

		<jaxrs:providers>
			<ref bean="jaxbWorksetProvider" />
			<ref bean="jsonWorksetProvider" />
		</jaxrs:providers>

		<jaxrs:schemaLocations>
			<jaxrs:schemaLocation>WEB-INF/classes/schemas/workset.xsd</jaxrs:schemaLocation>
            <jaxrs:schemaLocation>WEB-INF/classes/schemas/volume.xsd</jaxrs:schemaLocation>
            <jaxrs:schemaLocation>WEB-INF/classes/schemas/tag.xsd</jaxrs:schemaLocation>
		</jaxrs:schemaLocations>

		<jaxrs:extensionMappings>
			<entry key="xml" value="application/xml" />
			<entry key="json" value="application/json" />
      <entry key="csv" value="text/csv" />
			<entry key="txt" value="text/plain" />
		</jaxrs:extensionMappings>
	</jaxrs:server>

	<util:map id="propertiesMap">
		<entry key="jaxb.formatted.output">
			<value type="java.lang.Boolean">true</value>
		</entry>
	</util:map>

    <util:list id="extraWorksetClassesList">
       <value>edu.illinois.i3.htrc.registry.entities.workset.Worksets</value>
       <value>edu.illinois.i3.htrc.registry.entities.workset.Volumes</value>
       <value>edu.illinois.i3.htrc.registry.entities.workset.Tags</value>
    </util:list>

    <util:list id="xmlWorksetProduceTypes">
       <value>application/xml</value>
       <value>application/vnd.htrc-workset+xml</value>
       <value>application/vnd.htrc-volume+xml</value>
       <value>application/vnd.htrc-tag+xml</value>
    </util:list>

	<util:list id="jsonWorksetProduceTypes">
	   <value>application/json</value>
	   <value>application/vnd.htrc-workset+json</value>
       <value>application/vnd.htrc-volume+json</value>
       <value>application/vnd.htrc-tag+json</value>
	</util:list>

    <util:list id="xmlWorksetConsumeTypes">
       <value>application/vnd.htrc-workset+xml</value>
       <value>application/vnd.htrc-volume+xml</value>
    </util:list>

    <util:list id="jsonWorksetConsumeTypes">
       <value>application/vnd.htrc-workset+json</value>
       <value>application/vnd.htrc-volume+json</value>
    </util:list>

    <!--
	<util:list id="jsonWorksetKeys">
	   <value>tags</value>
	   <value>comments</value>
	</util:list>
    -->

    <!--
    <util:map id="xmlWorksetNamespaceMap" map-class="java.util.Hashtable">
        <entry key="http://registry.htrc.i3.illinois.edu/entities/workset" value="w" />
    </util:map>
    -->

	<util:map id="jsonWorksetNamespaceMap" map-class="java.util.Hashtable">
		<entry key="http://registry.htrc.i3.illinois.edu/entities/workset" value="" />
	</util:map>

</beans>
